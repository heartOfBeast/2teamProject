<!doctype html>
<html
	xmlns:th="http://www.thymeleaf.org"
 	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="@{layout/default}">
	
<th:block layout:fragment="pageTitle">
<div class="page-header">
	<ol class="breadcrumb">
		<li class="breadcrumb-item">재고</li>
		<li class="breadcrumb-item active">재고조회</li>
	</ol>

	<ul class="app-actions">
		<li>
			<a href="#" id="reportrange">
				<span class="range-text"></span>
				<i class="icon-chevron-down"></i>	
			</a>
		</li>
		<li>
			<a href="#">
				<i class="icon-export"></i>
			</a>
		</li>
	</ul>
</div>
		
</th:block>
	
<th:block layout:fragment="container">
<style>
	.hidden-col {display: none;}
</style>
<div class="main-container">
	<div class="row gutters">
		<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-6">
			<div class="table-container">
				<div class="t-header">재고조회</div>
				<select id="spm" name="spm">
					<option class="spm" th:each="stockList : ${stockList}" th:value="${stockList.shoppingmallName}" th:text="${stockList.shoppingmallName}"></option>
				</select>
				<select id="ware" name="ware">
					<option class="ware" th:each="stockList : ${stockList}" th:value="${stockList.warehouseName}" th:text="${stockList.warehouseName}"></option>
				</select>
				<div class="table-responsive">
					<table id="copy-print-csv-KO" class="table custom-table">
						<thead>
							<tr >
							<th style="width: 100px">상품명</th>
							<th>거래처명</th>
							<th>창고명</th>
							<th class="hidden-col">보관위치</th>
							<th style="width: 50px">단위</th>
							<th style="width: 100px">전체수량</th>
							<th style="width: 100px">최근입고수량</th>
					 		<th style="width: 100px">최근출고수량</th>
					 		<th class="hidden-col">입고수량</th>
					 		<th class="hidden-col">입고날짜</th>
					 		<th class="hidden-col">출고수량</th>
					 		<th class="hidden-col">출고날짜</th>
							<th class="hidden-col">등록담당자</th>
							<th class="hidden-col">담당자연락처</th>
							<th class="hidden-col">등록일</th>
					 		<th style="width: 50px;" id="detail">상세</th>
							</tr>
						</thead>
						<tbody id="stockData">
							<tr th:each="L : ${stockList}">
								<td th:text="${L.productName}" id="dataPName"></td>
								<td th:text="${L.shoppingmallName}" id="dataSpmName"></td>
								<td th:text="${L.warehouseName}" id="dataWareName"></td>
								<td class="hidden-col" th:text="${L.finalSector}" id="dataFinalSector"></td>
								<td th:text="${L.stockUnit}" id="dataUnit"></td>
								<td th:text="${L.totalAmount}" id="dataTAmount"></td>
								<td th:text="${L.recentWarehousingAmount}" id="dataRecentWAmount"></td>
								<td th:text="${L.recentReleaseAmount}" id="dataRecentRAmount"></td>
								<td class="hidden-col" th:text="${L.warehousingRealAmount}" id="wareAmount"></td>
								<td class="hidden-col" th:text="${L.warehousingRealDate}" id="wareDate"></td>
								<td class="hidden-col" th:text="${L.releaseRealAmount}" id="relAmount"></td>
								<td class="hidden-col" th:text="${L.releaseRealDate}" id="relDate"></td>
								<td class="hidden-col" th:text="${L.wareAdminId}" id="dataAdminId"></td>
								<td class="hidden-col" th:text="${L.wareAdminPhone}" id="dataAdminPhone"></td>
								<td class="hidden-col" th:text="${L.stockRegDate}" id="dataRegDate"></td>
								<td>
									<button class="btn btn-outline-info detailModalBtn" data-toggle="modal" data-target=".bd-example-modal-lg">상세</button>
								</td>
							</tr>
						</tbody>
		    		</table>
				</div>
			</div>
		
		</div>
	</div>
</div>

	<div class="modal fade bd-example-modal-lg" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" style="display: none;" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="myLargeModalLabel">상세페이지</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">X</span>
					</button>
				</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="modalPName">상품명</label>
							<input type="text" class="form-control" name="modalPName" id="modalPName" readonly>
						</div>
						<div class="form-group">
							<label for="modalFinalSector">보관위치</label>
							<input type="text" class="form-control" name="modalFinalSector" id="modalFinalSector" readonly>
						</div>
						<div class="form-group">
							<label for="modalFinalSector">단위</label>
							<input type="text" class="form-control" name="modalUnit" id="modalUnit" readonly>
						</div>
						<div class="form-group">
							<label for="modalFinalSector">전체수량</label>
							<input type="text" class="form-control" name="modalTAmount" id="modalTAmount" readonly>
						</div>
						<div class="form-group">
							<label for="modalWareAmount">입고수량</label>
							<input type="text" class="form-control" name="modalWareAmount" id="modalWareAmount" readonly>
						</div>
						<div class="form-group">
							<label for="modalWareDate">입고날짜</label>
							<input type="text" class="form-control" name="modalWareDate" id="modalWareDate" readonly>
						</div>
						<div class="form-group">
							<label for="modalRelAmount">출고수량</label>
							<input type="text" class="form-control" name="modalRelAmount" id="modalRelAmount" readonly>
						</div>
						<div class="form-group">
							<label for="modalRelDate">출고날짜</label>
							<input type="text" class="form-control" name="modalRelDate" id="modalRelDate" readonly>
						</div>
						<div class="form-group">
							<label for="modalAdminId">등록담당자</label>
							<input type="text" class="form-control" name="modalAdminId" id="modalAdminId" readonly>
						</div>
						<div class="form-group">
							<label for="modalAdminPhone">담당자연락처</label>
							<input type="text" class="form-control" name="modalAdminPhone" id="modalAdminPhone" readonly>
						</div>
						
						<!--  나중에 테이블 형식으로 바꿀 수 있을 지 생각해보고 바꿀 수 있다면 바꾸자 ! -->					
						
<!--						<div class="table-container">
							<div class="table-responsive">
								<table class="table custom-table m-0">
									<tbody>
										<tr>
											<th class="text-left">상품명</th>
											<td id="modalPName"></td>
										</tr>
										<tr>
											<th class="text-left"  style="width: 150px">보관위치</th>
											<td id="modalFinalSector"></td>
										</tr>
										<tr>
											<th class="text-left">입고수량</th>
											<td id="modalWareAmount"></td>
										</tr>
										<tr>
											<th class="text-left">입고날짜</th>
											<td id="modalWareDate"></td>
										</tr>
										<tr>
											<th class="text-left">출고수량</th>
											<td id="modalRelAmount"></td>
										</tr>
										<tr>
											<th class="text-left">출고날짜</th>
											<td id="modalRelDate"></td>
										</tr>
										<tr>
											<th class="text-left">등록담당자</th>
											<td id="modalAdminId"></td>
										</tr>
										<tr>
											<th class="text-left">담당자연락처</th>
											<td id="modalAdminPhone"></td>
										</tr>
									</tbody>
								</table>					
							</div>
						</div>-->
					</div>
					<div class="modal-footer">
						<button class="btn btn-secondary" data-dismiss="modal" >닫기</button>
					</div>
			</div>
		</div>
	</div>


</th:block>
<th:block layout:fragment="customJs">
	<script type="text/javascript" th:inline="javascript">
	$(document).ready(function(){
		$('#detail').removeClass('sorting')});
	
 	var currentPage = [[${#httpServletRequest.requestURI}]];
//	console.log(currentPage)	
	var aObj = $('.sidebar-menu a');
//	console.log(aObj);
	$.each(aObj, function(){
		let parentObj = $(this).parents('.sidebar-dropdown');
		let ahref = $(this).attr('href');
//		console.log(ahref)
		if(currentPage == ahref){
			$(parentObj).addClass('active');
			$(this).addClass('current-page');
			return false;
		}
	});	
/********************************************* select 제이쿼리 이용 중복 제거 *********************************************/
 	var test = [[${stockList}]];
 	var shoppingmallName = [];
	var warehouseName = [];
	
	for(var i = 0; i < test.length; i++){
		shoppingmallName.push(test[i].shoppingmallName);
	}
	var spmUniqie = [...new Set(shoppingmallName)];
	
	for(var i = 0; i < test.length; i++){
		warehouseName.push(test[i].warehouseName);
	}
	var warehouseUnique = [...new Set(warehouseName)];
	
	
	var htmlSpm = "";
	var htmlWare = "";
	
		htmlSpm += '<option disabled="disabled" selected="selected">:: 거래처명 선택 ::</option>';
		htmlWare += '<option disabled="disabled" selected="selected">:: 창고명 선택 ::</option>';
	
	for(var i = 0; i < spmUniqie.length; i++){
		htmlSpm += '<option>';
		htmlSpm += spmUniqie[i];
		htmlSpm += '</option>';
	}
	
	for(var i = 0; i < warehouseUnique.length; i++){
		htmlWare += '<option>';
		htmlWare += warehouseUnique[i];
		htmlWare += '</option>';
	}
	
	$('#spm').html(htmlSpm); 
	$('#ware').html(htmlWare); 
	
	
	/********************************************* ajax *********************************************/	
	var selectSpmValue = "";
	var selectWareValue = "";
	
	$('#spm').change(function(){
		selectSpmValue = $('#spm option:selected').val();
		getData();
	});
	
	$('#ware').change(function(){
		selectWareValue = $('#ware option:selected').val();
		getData();
	}); 
	function getData(){  	
		$.ajax({
	   		url : "/StockListDetail", 
			data : { shoppingmall_name : selectSpmValue, warehouse_name : selectWareValue },
			success : function(res){
			$('#stockData').children().remove();
		
		var innerHtml = '';
		$.each(res, function( index, value){
			innerHtml += '<tr>'	
            	innerHtml += '<td id="dataPName">'+value.productName+'</td>'
        		innerHtml += '<td id="dataSpmName">'+value.shoppingmallName+'</td>'
       			innerHtml += '<td id="dataWareName">'+value.warehouseName+'</td>'
				innerHtml += '<td id="dataUnit">'+value.stockUnit+'</td>'
	            innerHtml += '<td id="dataRecentWAmount">'+value.recentWarehousingAmount+'</td>'
	            innerHtml += '<td id="dataRecentRAmount">'+value.recentReleaseAmount+'</td>'
				innerHtml += '<td id="dataTAmount">'+value.totalAmount+'</td>'
				innerHtml += '<td class="hidden-col id="dataAdminId">'+value.wareAdminId+'</td>'
				innerHtml += '<td class="hidden-col id="dataAdminPhone">'+value.wareAdminPhone+'</td>'
				innerHtml += '<td class="hidden-col id="dataRegDate">'+value.stockRegDate+'</td>'
				innerHtml += '<td><button class="btn btn-outline-info detailModalBtn" data-toggle="modal" data-target=".bd-example-modal-lg">상세</button></td>'
				innerHtml += '</tr>'
				
		});
		$('#stockData').append(innerHtml);
		
		$('.detailModalBtn').each(function(){
		$(this).click(function(){

		var dataPName = $(this).parents('tr').children('#dataPName').text();
		var dataFinalSector = $(this).parents('tr').children('#dataFinalSector').text();
		var dataWareName = $(this).parents('tr').children('#dataWareName').text();
		var dataUnit = $(this).parents('tr').children('#dataUnit').text();
		var dataTAmount = $(this).parents('tr').children('#dataTAmount').text();
		var dataRecentWAmount = $(this).parents('tr').children('#dataRecentWAmount').text();
		var dataRecentRAmount = $(this).parents('tr').children('#dataRecentRAmount').text();
		var wareAmount = $(this).parents('tr').children('#wareAmount').text();
		var wareDate = $(this).parents('tr').children('#wareDate').text();
		var relAmount = $(this).parents('tr').children('#relAmount').text();
		var relDate = $(this).parents('tr').children('#relDate').text();
		var dataAdminId = $(this).parents('tr').children('#dataAdminId').text();
		var adminPhone = $(this).parents('tr').children('#adminPhone').text();
		var regDate = $(this).parents('tr').children('#regDate').text();
		
		$('#modalPName').val(dataPName);
		$('#modalFinalSector').val(dataFinalSector);
		$('#modalUnit').val(dataUnit);
		$('#modalTAmount').val(dataTAmount);
		$('#modalWareAmount').val(wareAmount);
		$('#modalWareDate').val(wareDate);
		$('#modalRelAmount').val(relAmount);
		$('#modalRelDate').val(relDate);
		$('#modalAdminId').val(dataAdminId);
		$('#modalAdminPhone').val(adminPhone);
		
					})
				})
			}
		})
	}
/********************************************* 모달 관련 Js *********************************************/	
	
	$('.detailModalBtn').each(function(){
		$(this).click(function(){
		var dataPName = $(this).parents('tr').children('#dataPName').text();
		var dataFinalSector = $(this).parents('tr').children('#dataFinalSector').text();
		var dataWareName = $(this).parents('tr').children('#dataWareName').text();
		var dataUnit = $(this).parents('tr').children('#dataUnit').text();
		var dataTAmount = $(this).parents('tr').children('#dataTAmount').text();
		var dataRecentWAmount = $(this).parents('tr').children('#dataRecentWAmount').text();
		var dataRecentRAmount = $(this).parents('tr').children('#dataRecentRAmount').text();
		var wareAmount = $(this).parents('tr').children('#wareAmount').text();
		var wareDate = $(this).parents('tr').children('#wareDate').text();
		var relAmount = $(this).parents('tr').children('#relAmount').text();
		var relDate = $(this).parents('tr').children('#relDate').text();
		var dataAdminId = $(this).parents('tr').children('#dataAdminId').text();
		var dataAdminPhone = $(this).parents('tr').children('#dataAdminPhone').text();
		var regDate = $(this).parents('tr').children('#regDate').text();
		
		$('#modalPName').val(dataPName);
		$('#modalFinalSector').val(dataFinalSector);
		$('#modalUnit').val(dataUnit);
		$('#modalTAmount').val(dataTAmount);
		$('#modalWareAmount').val(wareAmount);
		$('#modalWareDate').val(wareDate);
		$('#modalRelAmount').val(relAmount);
		$('#modalRelDate').val(relDate);
		$('#modalAdminId').val(dataAdminId);
		$('#modalAdminPhone').val(dataAdminPhone);
		
		})
	})
	
	

	</script>
</th:block>
		
</html>