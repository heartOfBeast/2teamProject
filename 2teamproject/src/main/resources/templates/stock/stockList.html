<!doctype html>
<html
	xmlns:th="http://www.thymeleaf.org"
 	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="@{layout/default}">
	
<th:block layout:fragment="pageTitle">
<div class="page-header">
	<ol class="breadcrumb">
		<li class="breadcrumb-item">재고</li>
		<li class="breadcrumb-item active">재고조회</li>
	</ol>

	<ul class="app-actions">
		<li>
			<a href="#" id="reportrange">
				<span class="range-text"></span>
				<i class="icon-chevron-down"></i>	
			</a>
		</li>
		<li>
			<a href="#">
				<i class="icon-export"></i>
			</a>
		</li>
	</ul>
</div>
		
</th:block>
	
<th:block layout:fragment="container">
<div class="main-container">
	<div class="row gutters">
		<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-6">
			<div class="table-container">
				<div class="t-header">재고조회</div>
				<select id="spm" name="spm">
					<option class="spm" th:each="stockList : ${stockList}" th:value="${stockList.shoppingmallName}" th:text="${stockList.shoppingmallName}"></option>
				</select>
				<select id="ware" name="ware">
					<option class="ware" th:each="stockList : ${stockList}" th:value="${stockList.warehouseName}" th:text="${stockList.warehouseName}"></option>
				</select>
				<div class="table-responsive">
					<table id="copy-print-csv" class="table custom-table">
						<thead>
							<tr >
							  <th>상품명</th>
							  <th>거래처명</th>
							  <th>창고명</th>
							  <th>보관위치</th>
							  <th>단위</th>
							  <th>최근입고수량</th>
							  <th>최근출고수량</th>
							  <th>전체수량</th>
							  <th>등록담당자</th>
							  <th>담당자연락처</th>
							  <th>등록일</th>
							</tr>
						</thead>
						<tbody id="stockData">
							<tr th:each="L : ${stockList}">
								<td th:text="${L.productName}"></td>
								<td th:text="${L.shoppingmallName}"></td>
								<td th:text="${L.warehouseName}"></td>
								<td th:text="${L.finalSector}"></td>
								<td th:text="${L.stockUnit}"></td>
								<td th:text="${L.recentWarehousingAmount}"></td>
								<td th:text="${L.recentReleaseAmount}"></td>
								<td th:text="${L.totalAmount}"></td>
								<td th:text="${L.wareAdminId}"></td>
								<td th:text="${L.wareAdminPhone}"></td>
								<td th:text="${L.stockRegDate}"></td>
							</tr>
						</tbody>
		    		</table>
				</div>
			</div>
		
		</div>
	</div>
</div>


</th:block>
<th:block layout:fragment="customJs">
	<script th:inline="javascript">

	
/********************************************* select 제이쿼리 이용 중복 제거 *********************************************/
 	var test = [[${stockList}]];
 	var shoppingmallName = [];
	var warehouseName = [];
	
	for(var i = 0; i < test.length; i++){
		shoppingmallName.push(test[i].shoppingmallName);
	}
	var spmUniqie = [...new Set(shoppingmallName)];
	
	for(var i = 0; i < test.length; i++){
		warehouseName.push(test[i].warehouseName);
	}
	var warehouseUnique = [...new Set(warehouseName)];
	
	
	var htmlSpm = "";
	var htmlWare = "";
	
		htmlSpm += '<option disabled="disabled" selected="selected">:: 거래처명 선택 ::</option>';
		htmlWare += '<option disabled="disabled" selected="selected">:: 창고명 선택 ::</option>';
	
	for(var i = 0; i < spmUniqie.length; i++){
		htmlSpm += '<option>';
		htmlSpm += spmUniqie[i];
		htmlSpm += '</option>';
	}
	
	for(var i = 0; i < warehouseUnique.length; i++){
		htmlWare += '<option>';
		htmlWare += warehouseUnique[i];
		htmlWare += '</option>';
	}
	
	$('#spm').html(htmlSpm); 
	$('#ware').html(htmlWare); 
	
	
	/*********************************************  *********************************************/	
	var selectSpmValue = "";
	var selectWareValue = "";
	
	$('#spm').change(function(){
		selectSpmValue = $('#spm option:selected').val();
		getData();
	});
	
	$('#ware').change(function(){
		selectWareValue = $('#ware option:selected').val();
		getData();
	}); 
	function getData(){  	
		$.ajax({
	   		url : "/StockListDetail", 
			data : { shoppingmall_name : selectSpmValue, warehouse_name : selectWareValue },
			success : function(res){
			$('#stockData').children().remove();
		
		var innerHtml = '';
		$.each(res, function( index, value){
			innerHtml += '<tr>'	
            	innerHtml += '<td>'+value.productName+'</td>'
        		innerHtml += '<td>'+value.shoppingmallName+'</td>'
       			innerHtml += '<td>'+value.warehouseName+'</td>'
   				innerHtml += '<td>'+value.finalSector+'</td>'
				innerHtml += '<td>'+value.stockUnit+'</td>'
	            innerHtml += '<td>'+value.recentWarehousingAmount+'</td>'
	            innerHtml += '<td>'+value.recentReleaseAmount+'</td>'
				innerHtml += '<td>'+value.totalAmount+'</td>'
				innerHtml += '<td>'+value.wareAdminId+'</td>'
				innerHtml += '<td>'+value.wareAdminPhone+'</td>'
				innerHtml += '<td>'+value.stockRegDate+'</td>'
				innerHtml += '</tr>'
				
		});
		$('#stockData').append(innerHtml);
		
			}
		})
	}
	
	
	
	

	</script>
</th:block>
		
</html>